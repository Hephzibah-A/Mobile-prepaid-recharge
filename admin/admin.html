<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <h4 class="p-3">Admin Panel</h4>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link active" href="#" onclick="showPage('dashboard')">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('recharge-history')">Recharge
                    History</a></li>
            <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('analytics')">Analytics</a></li>
            <li class="nav-item"><a class="nav-link" href="#" onclick="logout()">Logout</a></li>
        </ul>
    </nav>

    <!-- Dashboard Page -->
    <div id="dashboard" class="content">
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stats-card" style="border-left: 4px solid var(--retro-teal)">
                    <h5>Total Users</h5>
                    <h2 id="total-users">1,234</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card" style="border-left: 4px solid var(--retro-mustard)">
                    <h5>Active Users</h5>
                    <h2 id="active-users">1,024</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card" style="border-left: 4px solid var(--retro-coral)">
                    <h5>Expiring Soon</h5>
                    <h2 id="expiring-users">50</h2>
                </div>
            </div>
        </div>

        <h3>Expiring Subscriptions (Next 3 Days)</h3>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Subscriber Name</th>
                    <th>Mobile Number</th>
                    <th>Plan Expiry Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="dashboard-data"></tbody>
        </table>
    </div>

    <!-- Recharge History Page -->
    <div id="recharge-history" class="content d-none">
        <h3>Recharge History</h3>
        <div id="user-list">
            <!-- Dummy user cards will be inserted here -->
        </div>
    </div>

    <!-- Analytics Page -->
    <div id="analytics" class="content d-none">
        <div class="chart-container" style="height: 90vh; justify-items: center;">
            <canvas id="planDistributionChart"></canvas>
        </div>
        <div class="bento-grid">
            <div class="chart-container">
                <canvas id="revenueChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="userGrowthChart"></canvas>
            </div>

        </div>
    </div>

    <!-- User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="userDetailsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">Notification sent successfully!</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                aria-label="Close"></button>
        </div>
    </div>

    <script>
        // Dummy Data Generation
        const generateUsers = (count) => {
            const users = [];
            for (let i = 1; i <= count; i++) {
                users.push({
                    id: i,
                    name: `User ${i}`,
                    number: `98765432${i.toString().padStart(2, '0')}`,
                    expiry: `${i % 28 + 1}-Feb-2024`,
                    recharges: Array.from({ length: Math.floor(Math.random() * 5) + 1 }, (_, j) => ({
                        date: `${j + 1}-Feb-2024`,
                        plan: `${(j + 1) * 2}GB Data Plan`,
                        payment: j % 2 === 0 ? 'UPI' : 'Credit Card'
                    }))
                });
            }
            return users;
        };

        const allUsers = generateUsers(50);

        // Initialize Dashboard
        document.getElementById('dashboard-data').innerHTML = allUsers.map(user => `
            <tr>
                <td>${user.name}</td>
                <td>${user.number}</td>
                <td>${user.expiry}</td>
                <td><button class="btn btn-warning" onclick="showToast()">Notify</button></td>
            </tr>
        `).join('');

        // Initialize Recharge History
        document.getElementById('user-list').innerHTML = allUsers.map(user => `
            <div class="user-card" onclick="showUserDetails(${user.id})">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>${user.name}</h6>
                        <small class="text-muted">${user.number}</small>
                    </div>
                    <div class="text-end">
                        <small>Last Recharge: ${user.recharges[0].date}</small><br>
                        <small class="text-success">${user.recharges[0].plan}</small>
                    </div>
                </div>
            </div>
        `).join('');

        // Chart Configurations
        const chartOptions = {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, color: '#4a4a4a' }
            },
            scales: {
                y: { grid: { color: '#e0e0e0' } },
                x: { grid: { color: '#e0e0e0' } }
            }
        };

        // Revenue Chart
        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                datasets: [{
                    label: 'Revenue (â‚¹ Lakhs)',
                    data: [12, 19, 3, 5, 2],
                    borderColor: '#2c7873',
                    tension: 0.4
                }]
            },
            options: chartOptions
        });

        // User Growth Chart
        new Chart(document.getElementById('userGrowthChart'), {
            type: 'bar',
            data: {
                labels: ['2020', '2021', '2022', '2023'],
                datasets: [{
                    label: 'Total Users',
                    data: [400, 700, 900, 1200],
                    backgroundColor: '#f7c45a'
                }]
            },
            options: chartOptions
        });

        // Plan Distribution Chart
        new Chart(document.getElementById('planDistributionChart'), {
            type: 'doughnut',
            data: {
                labels: ['Basic', 'Standard', 'Premium'],
                datasets: [{
                    data: [300, 500, 200],
                    backgroundColor: ['#2c7873', '#f7c45a', '#ff6b6b']
                }]
            },
            options: chartOptions
        });

        // Show User Details Modal
        function showUserDetails(userId) {
            const user = allUsers.find(u => u.id === userId);
            const modalContent = `
                <h6>${user.name}</h6>
                <p>Mobile: ${user.number}</p>
                <h6 class="mt-3">Recharge History:</h6>
                <ul class="list-group">
                    ${user.recharges.map(recharge => `
                        <li class="list-group-item d-flex justify-content-between">
                            <div>
                                <strong>${recharge.plan}</strong><br>
                                <small>${recharge.date}</small>
                            </div>
                            <span class="badge bg-primary">${recharge.payment}</span>
                        </li>
                    `).join('')}
                </ul>
            `;
            document.getElementById('userDetailsContent').innerHTML = modalContent;
            new bootstrap.Modal('#userModal').show();
        }

        // Toast Function
        const toastEl = document.querySelector('.toast');
        const toast = new bootstrap.Toast(toastEl);
        function showToast() {
            toast.show();
        }

        // Page Navigation
        function showPage(page) {
            document.querySelectorAll('.content').forEach(el => el.classList.add('d-none'));
            document.getElementById(page).classList.remove('d-none');
        }

        function logout() {
            window.location.href = '#';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>