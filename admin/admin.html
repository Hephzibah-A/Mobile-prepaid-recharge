<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Mobile Recharge</title>

  <!-- Paper Dashboard CSS -->
  <link href="assets/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/paper-dashboard.css" rel="stylesheet">
  <link href="assets/css/demo.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />

  <!-- FontAwesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Code injected by Five-server -->
  <script async data-id="five-server" data-file="d:\TM JFS\CAPSTONE PROJECT 1\Mobile Prepaid Recharge\admin\admin.html"
    type="application/javascript" src="/fiveserver.js"></script>
</head>

<style>
  /* Toast Notification Styles */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1050;
    background-color: #28a745;
    /* Green for success */
    color: white;
    border-radius: 8px;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    width: 300px;
  }

  .toast.show {
    opacity: 0.95;
    visibility: visible;
  }

  .toast-body {
    font-size: 14px;
    padding: 10px 15px;
  }

  .toast .btn-close {
    color: white;
    opacity: 1;
  }

  .toast .btn-close:hover {
    color: red;
  }

  .toast-close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    position: absolute;
    top: 10px;
    right: 10px;
  }

  #managePlansSection {
    display: none;
    margin-top: 20px;
  }



  .btn-sm {
    margin-right: 5px;
  }
</style>

<body>

  <div class="wrapper">
    <!-- Sidebar -->
    <div class="sidebar" data-color="purple" data-active-color="danger">
      <div class="logo">
        <a href="#" class="simple-text logo-mini">
          <i class="fa fa-mobile"></i>
        </a>
        <a href="#" class="simple-text logo-normal">
          Admin Panel
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item sidenav-dashboard active">
            <a href="#" onclick="showSection('dashboardSection', this)">
              <i class="fa fa-home"></i>
              <p>Dashboard</p>
            </a>
          </li>
          <li class="nav-item sidenav-manage-plans">
            <a href="#" onclick="showSection('managePlansSection', this)">
              <i class="ri-file-list-line"></i>
              <p>Manage Plans</p>
            </a>
          </li>
          <li class="nav-item sidenav-users">
            <a href="#" onclick="showSection('usersSection', this)">
              <i class="fa fa-users"></i>
              <p>Users</p>
            </a>
          </li>
          <li class="nav-item sidenav-transactions">
            <a href="#" onclick="showSection('transactionsSection', this)">
              <i class="fa fa-wallet"></i>
              <p>Transactions</p>
            </a>
          </li>
          <li class="nav-item sidenav-analytics">
            <a href="#" onclick="showSection('analyticsSection', this)">
              <i class="fa fa-chart-bar"></i>
              <p>Analytics</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#">
              <i class="fa fa-sign-out-alt"></i>
              <p onclick="confirmLogout()">Logout</p>
              <script>
                function confirmLogout() {
                  if (confirm("Are you sure you want to logout?")) {
                    // Redirect to login page or perform logout action
                    window.location.href = "login.html";
                  }
                }
              </script>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-panel">
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="#">Admin Dashboard</a>
          </div>
        </div>
      </nav>

      <!-- Sections -->
      <div class="content">
        <div class="container-fluid">

          <!-- Dashboard Section (Default Visible) -->
          <div id="dashboardSection" class="admin-section">
            <div class="row">
              <div class="col-lg-4 col-md-6">
                <div class="card card-stats">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-warning">
                          <i class="fa fa-users text-primary"></i>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">Total Users</p>
                          <h4 class="card-title" id="totalUsers">0</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-6">
                <div class="card card-stats">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-success">
                          <i class="fa fa-dollar-sign text-success"></i>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">Total Transactions</p>
                          <h4 class="card-title" id="totalTransactions">0</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-4 col-md-6">
                <div class="card card-stats">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-5">
                        <div class="icon-big text-center icon-warning">
                          <i class="fa fa-clock text-warning"></i>
                        </div>
                      </div>
                      <div class="col-7">
                        <div class="numbers">
                          <p class="card-category">Pending Requests</p>
                          <h4 class="card-title" id="pendingRequests">0</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header">
                    <h4 class="card-title">Plans Expiring in 3 Days</h4>
                  </div>
                  <div class="card-body">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>User ID</th>
                          <th>Name</th>
                          <th>Mobile</th>
                          <th>Plan</th>
                          <th>Expiry Date</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody id="expiringPlansTable">
                        <!-- Expiring Plan Data Will Be Inserted Here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

          </div>
          <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
            <div id="notificationToast" class="toast align-items-center text-white bg-success border-0" role="alert">
              <div class="d-flex">
                <div class="toast-body" id="toastMessage">
                  <!-- Message will be inserted dynamically -->
                </div>
                <button type="button" class="toast-close-btn" onclick="hideToast()">
                  <i class="ri-close-line"></i>
                </button>
              </div>
            </div>
          </div>
          <!-- Other Sections (Initially Hidden) -->

          <!-- Manage Plans Section -->
          <div id="managePlansSection" class="admin-section" style="display: none;">
            <div class="container mt-4">
              <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h4 class="card-title">Manage Plans</h4>
                  <button class="btn btn-success" onclick="showAddPlanModal()">Add Plan</button>
                </div>
                <div class="card-body">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Plan ID</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Validity</th>
                        <th>Data</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="plansTable">
                      <!-- Plans will be dynamically added here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Add/Edit Plan Modal -->
          <div class="modal fade" id="planModal" tabindex="-1" aria-labelledby="planModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="planModalLabel">Add Plan</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form id="planForm">
                    <input type="hidden" id="planId">
                    <div class="mb-3">
                      <label for="planName" class="form-label">Plan Name</label>
                      <input type="text" class="form-control" id="planName" required>
                    </div>
                    <div class="mb-3">
                      <label for="planPrice" class="form-label">Price</label>
                      <input type="number" class="form-control" id="planPrice" required>
                    </div>
                    <div class="mb-3">
                      <label for="planValidity" class="form-label">Validity (Days)</label>
                      <input type="number" class="form-control" id="planValidity" required>
                    </div>
                    <div class="mb-3">
                      <label for="planData" class="form-label">Data (GB/Day)</label>
                      <input type="text" class="form-control" id="planData" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Plan</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <div id="usersSection" class="admin-section" style="display: none;">
            <h3>Users</h3>
            <div class="container mt-4">
              <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h4 class="card-title">Manage Users</h4>
                  <button class="btn btn-success" onclick="showAddUserModal()">Add User</button>
                </div>
                <div class="card-body">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Mobile</th>
                        <th>Email</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="usersTable">
                      <!-- Users will be dynamically added here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Add/Edit User Modal -->
            <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">Add User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <form id="userForm">
                      <input type="hidden" id="userId">
                      <div class="mb-3">
                        <label for="userName" class="form-label">Name</label>
                        <input type="text" class="form-control" id="userName" required>
                      </div>
                      <div class="mb-3">
                        <label for="userMobile" class="form-label">Mobile</label>
                        <input type="text" class="form-control" id="userMobile" required>
                      </div>
                      <div class="mb-3">
                        <label for="userEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="userEmail" required>
                      </div>
                      <button type="submit" class="btn btn-primary">Save User</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            <script>
              document.addEventListener("DOMContentLoaded", function () {
                // Fetch plans from API and display in the table
                async function fetchPlans() {
                  try {
                    const response = await fetch("http://localhost:8082/api/plans/admin");
                    if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const plans = await response.json();

                    // Populate the plans table
                    const tableBody = document.getElementById("plansTable");
                    tableBody.innerHTML = "";
                    plans.forEach((plan, index) => {
                      const row = `
                      <tr>
                        <td>${plan.planId}</td>
                        <td>${plan.name}</td>
                        <td>‚Çπ${plan.planPrice}</td>
                        <td>${plan.validityDays} Days</td>
                        <td>${plan.data}</td>
                        <td>
                          <button class="btn btn-warning btn-sm" onclick="editPlan(${index})">‚úèÔ∏è</button>
                          <button class="btn btn-danger btn-sm" onclick="deletePlan(${index})">üóë</button>
                        </td>
                      </tr>`;
                      tableBody.innerHTML += row;
                    });
                  } catch (error) {
                    console.error("Error fetching plans:", error);
                  }
                }

                // Load plans on page load
                fetchPlans();
              });
            </script>
          </div>
          <div id="transactionsSection" class="admin-section" style="display: none;">
            <h3>Transactions</h3>
            <div class="container mt-4">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title">Transaction Management</h4>
                </div>
                <div class="card-body">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Transaction ID</th>
                        <th>User ID</th>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="transactionsTable"></tbody>
                    <!-- Transactions will be dynamically added here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <script>
              document.addEventListener("DOMContentLoaded", function () {
                let transactions = [
                  { id: "T001", userId: "U001", amount: 50, date: "2023-10-01", status: "Completed" },
                  { id: "T002", userId: "U002", amount: 30, date: "2023-10-02", status: "Pending" },
                  { id: "T003", userId: "U003", amount: 20, date: "2023-10-03", status: "Failed" }
                ];

                // Function to Load Transactions in Table
                function loadTransactions() {
                  let tableBody = document.getElementById("transactionsTable");
                  tableBody.innerHTML = "";
                  transactions.forEach((transaction, index) => {
                    let row = `<tr>
                  <td>${transaction.id}</td>
                  <td>${transaction.userId}</td>
                  <td>$${transaction.amount}</td>
                  <td>${transaction.date}</td>
                  <td>${transaction.status}</td>
                  <td>
                  <button class="btn btn-warning btn-sm" onclick="editTransaction(${index})">‚úèÔ∏è</button>
                  </td>
                </tr>`;
                    tableBody.innerHTML += row;
                  });
                }

                // Show Modal for Editing a Transaction
                window.editTransaction = function (index) {
                  let transaction = transactions[index];
                  alert(`Edit functionality for Transaction ID: ${transaction.id} is not implemented yet.`);
                };

                // Load Transactions on Page Load
                loadTransactions();
              });
            </script>
          </div>
          <div id="analyticsSection" class="admin-section" style="display: none;">
            <h3>Analytics</h3>
            <div class="container mt-4">
              <div class="row">
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h4 class="card-title">User Growth</h4>
                    </div>
                    <div class="card-body">
                      <canvas id="userGrowthChart"></canvas>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h4 class="card-title">Revenue Breakdown</h4>
                    </div>
                    <div class="card-body">
                      <canvas id="revenueChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mt-4">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-header">
                      <h4 class="card-title">Plan Popularity</h4>
                    </div>
                    <div class="card-body">
                      <canvas id="planPopularityChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
              document.addEventListener("DOMContentLoaded", function () {
                // User Growth Chart
                const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
                new Chart(userGrowthCtx, {
                  type: 'line',
                  data: {
                    labels: ['January', 'February', 'March', 'April', 'May', 'June'],
                    datasets: [{
                      label: 'New Users',
                      data: [50, 75, 100, 125, 150, 200],
                      borderColor: 'rgba(75, 192, 192, 1)',
                      backgroundColor: 'rgba(75, 192, 192, 0.2)',
                      borderWidth: 2
                    }]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      legend: { display: true }
                    }
                  }
                });

                // Revenue Breakdown Chart
                const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                new Chart(revenueCtx, {
                  type: 'doughnut',
                  data: {
                    labels: ['Basic Plan', 'Premium Plan', 'Unlimited Plan'],
                    datasets: [{
                      data: [3000, 5000, 7000],
                      backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                    }]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      legend: { display: true }
                    }
                  }
                });

                // Plan Popularity Chart
                const planPopularityCtx = document.getElementById('planPopularityChart').getContext('2d');
                new Chart(planPopularityCtx, {
                  type: 'bar',
                  data: {
                    labels: ['Basic Plan', 'Premium Plan', 'Unlimited Plan'],
                    datasets: [{
                      label: 'Number of Subscriptions',
                      data: [120, 200, 300],
                      backgroundColor: ['#4BC0C0', '#FF9F40', '#9966FF']
                    }]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      legend: { display: true }
                    },
                    scales: {
                      y: { beginAtZero: true }
                    }
                  }
                });
              });
            </script>
          </div>

        </div>
      </div>

    </div>
  </div>

  <!-- JavaScript -->
  <script>
    function showSection(sectionId, clickedElement) {
      // Hide all sections
      document.querySelectorAll(".admin-section").forEach(section => section.style.display = "none");

      // Show the selected section
      document.getElementById(sectionId).style.display = "block";

      // Remove "active" from all menu items
      document.querySelectorAll(".nav-item").forEach(item => item.classList.remove("active"));

      // Add "active" to clicked menu item
      clickedElement.parentElement.classList.add("active");

      // Save active section
      localStorage.setItem("activeSection", sectionId);
    }

    document.addEventListener("DOMContentLoaded", function () {
      const savedSection = localStorage.getItem("activeSection") || "dashboardSection";

      // Set active menu item
      document.querySelector(`.sidenav-${savedSection.replace("Section", "")}`)?.classList.add("active");

      showSection(savedSection, document.querySelector(`.sidenav-${savedSection.replace("Section", "")} a`));
    });
  </script>

  <script>

    // Dummy User Data (Fetched from Backend in Real Use)
    const users = [
      { id: "U123", name: "Alice Johnson", mobile: "9876543210", plan: "Premium 28 Days", expiry: "2025-03-25" },
      { id: "U124", name: "Bob Smith", mobile: "9876543211", plan: "Basic 7 Days", expiry: "2025-03-25" },
      { id: "U125", name: "Charlie Brown", mobile: "9876543212", plan: "Standard 14 Days", expiry: "2025-03-26" },
      { id: "U126", name: "David Miller", mobile: "9876543213", plan: "Unlimited 30 Days", expiry: "2025-03-27" }
    ];

    // Function to Check for Plans Expiring in 3 Days
    function getExpiringPlans() {
      const today = new Date();
      const expiringPlansTable = document.getElementById("expiringPlansTable");
      expiringPlansTable.innerHTML = ""; // Clear table before adding new rows

      users.forEach(user => {
        let expiryDate = new Date(user.expiry);
        let diffInDays = Math.floor((expiryDate - today) / (1000 * 60 * 60 * 24));

        if (diffInDays <= 3 && diffInDays >= 0) { // Only show plans expiring within 3 days
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.mobile}</td>
                    <td>${user.plan}</td>
                    <td>${user.expiry}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="notifyUser('${user.name}', '${user.mobile}')">
                            Notify
                        </button>
                    </td>
                `;
          expiringPlansTable.appendChild(row);
        }
      });
    }

    function notifyUser(name, mobile) {
      document.getElementById("toastMessage").innerText = `Notification sent to ${name} (${mobile})`;
      let toast = new bootstrap.Toast(document.getElementById("notificationToast"));
      toast.show();
    }
    function showToast(message) {
      let toast = document.getElementById("toastNotification");
      let toastBody = document.getElementById("toastMessage");

      toastBody.innerText = message;
      toast.classList.add("show");

      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000); // Hide toast after 3 seconds
    }

    // Load Expiring Plans on Page Load
    getExpiringPlans();

  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let plans = [
        { id: "P001", name: "Basic Plan", price: 20, validity: 28, data: "2GB/Day" },
        { id: "P002", name: "Premium Plan", price: 50, validity: 56, data: "5GB/Day" },
        { id: "P003", name: "Unlimited Plan", price: 100, validity: 90, data: "Unlimited" }
      ];

      // Function to Load Plans in Table
      function loadPlans() {
        let tableBody = document.getElementById("plansTable");
        tableBody.innerHTML = "";
        plans.forEach((plan, index) => {
          let row = `<tr>
        <td>${plan.id}</td>
        <td>${plan.name}</td>
        <td>$${plan.price}</td>
        <td>${plan.validity} Days</td>
        <td>${plan.data}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="editPlan(${index})">‚úèÔ∏è</button>
          <button class="btn btn-danger btn-sm" onclick="deletePlan(${index})">üóë</button>
        </td>
      </tr>`;
          tableBody.innerHTML += row;
        });
      }

      // Show Modal for Adding a New Plan
      window.showAddPlanModal = function () {
        document.getElementById("planForm").reset();
        document.getElementById("planId").value = "";
        document.getElementById("planModalLabel").textContent = "Add Plan";
        let planModal = new bootstrap.Modal(document.getElementById("planModal"));
        planModal.show();
      };

      // Show Modal for Editing a Plan
      window.editPlan = function (index) {
        let plan = plans[index];
        document.getElementById("planId").value = index;
        document.getElementById("planName").value = plan.name;
        document.getElementById("planPrice").value = plan.price;
        document.getElementById("planValidity").value = plan.validity;
        document.getElementById("planData").value = plan.data;
        document.getElementById("planModalLabel").textContent = "Edit Plan";
        let planModal = new bootstrap.Modal(document.getElementById("planModal"));
        planModal.show();
      };

      // Handle Add/Edit Plan Form Submission
      document.getElementById("planForm").addEventListener("submit", function (e) {
        e.preventDefault();
        let id = document.getElementById("planId").value;
        let name = document.getElementById("planName").value;
        let price = document.getElementById("planPrice").value;
        let validity = document.getElementById("planValidity").value;
        let data = document.getElementById("planData").value;

        if (id === "") {
          // Add New Plan
          let newPlan = {
            id: "P00" + (plans.length + 1),
            name,
            price,
            validity,
            data
          };
          plans.push(newPlan);
        } else {
          // Edit Existing Plan
          plans[id] = { id: plans[id].id, name, price, validity, data };
        }

        loadPlans();
        let planModal = bootstrap.Modal.getInstance(document.getElementById("planModal"));
        planModal.hide();
      });

      // Delete a Plan
      window.deletePlan = function (index) {
        plans.splice(index, 1);
        loadPlans();
      };

      // Load Plans on Page Load
      loadPlans();
    });

  </script>
</body>

</html>